version: '3.8'

services:
  agent:
    build: .
    container_name: cua-agent-template
    environment:
      # Required environment variables - set these in .env file or override here
      - CUA_API_KEY=${CUA_API_KEY}
      - CUA_SANDBOX_NAME=${CUA_SANDBOX_NAME}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      # Optional environment variables
      - PYTHONUNBUFFERED=1
      - DISPLAY=:99
    volumes:
      # Mount trajectories directory to persist data
      - ./trajectories:/app/trajectories
      # Mount logs directory
      - ./logs:/app/logs
      # Mount .env file if it exists
      - ./.env:/app/.env:ro
    ports:
      # Expose port for potential web interface
      - "8000:8000"
    # For GUI applications (if needed)
    stdin_open: true
    tty: true
    # Security
    user: "1000:1000"
    # Restart policy
    restart: unless-stopped

  # Optional: X11 server for GUI applications
  xvfb:
    image: selenium/standalone-chrome:latest
    container_name: cua-xvfb
    environment:
      - DISPLAY=:99
    ports:
      - "4444:4444"
    # Only start if GUI is needed
    profiles:
      - gui
